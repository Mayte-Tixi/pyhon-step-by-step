(()=>{var t={574:()=>{class t extends HTMLElement{constructor(){super()}connectedCallback(){const t=JSON.parse(this.getAttribute("options")),e=document.createElement("div");e.className="menuOptions__container",e.id="unir-bot-menu",t.length>0&&t.map(((t,n)=>{if("text"in t&&"action"in t&&"actionOptions"in t){const a=document.createElement("div"),o=`menuOptions__text__${n}`;a.className="menuOptions__option";const i=JSON.parse(t.actionOptions);i.id=o,a.addEventListener("click",(()=>{window.EventEmitter.emit(t.action,i)}));const s=document.createElement("p");s.textContent=t.text,s.id=o,s.className="menuOptions__text",a.appendChild(s),e.appendChild(a)}})),this.appendChild(e)}}customElements.define("bot-menu",t)}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,n),i.exports}(()=>{"use strict";function t(t){const e={};if(void 0!==t){const n=Object.keys(localStorage);let a,o=0;for(;a=n[o];o++)a.includes(t)&&(e[a]=localStorage.getItem(a))}return e}class e{constructor(){return this._events={},"object"==typeof e.instance?e.instance:(e.instance=this,this)}on(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)}removeListeners(){this._events={}}removeListener(t,e){if(!this._events[t])throw new Error(`Can't remove a listener. Event "${t}" does not exists`);this._events[t]=this._events[t].filter((t=>t!==e))}emit(t,e){if(!this._events[t])throw new Error(`Can't emit an event. Event "${t}" does not exists`);this._events[t].forEach((t=>{t(e)}))}}n(574);const a="unir-bot-webchat",o=a+"-button",i=a+"-container",s=a+"-holder",r=a+"-header",d=a+"-button-minimize",c=a+"-root";var l="unknown";let u,m=null,p=null;var f=null;const g={StudentPreferences:{StudentId:"0",DisableStartMaximized:null},TermsOfUseInfo:{StudentId:"0",IsTermsOfUseAccepted:!1,TermsAndConditionsOfUseUrl:""}};let h,y,v=!1,b=!1;function w(t,e,n){const a=document.createElement("script");a.type="text/javascript",a.setAttribute("src",t),a.setAttribute("crossorigin","anonymous"),e&&a.setAttribute("async",""),n&&a.setAttribute("defer",""),document.head.appendChild(a)}function C(){return{left:botWebChatSettings.boundaryPadding,top:botWebChatSettings.boundaryPadding,right:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)-botWebChatSettings.boundaryPadding,bottom:Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)-botWebChatSettings.boundaryPadding-1}}function I(t,e){let n,a;null==m&&null==p&&(m=t.offsetLeft,p=t.offsetTop),t.onmouseenter=function(e){e.preventDefault(),t.classList.add("drag")},t.onmouseleave=function(e){e.preventDefault(),t.classList.remove("drag"),t.classList.remove("dragging")},t.onmousedown=function(e){e.preventDefault(),t.classList.remove("drag"),t.classList.add("dragging"),h=t,n=e.clientX-t.offsetLeft,a=e.clientY-t.offsetTop},document.onmouseup=function(e){h&&(t.classList.add("drag"),t.classList.remove("dragging"),h=null,e.preventDefault(),e.stopPropagation())},document.onmousemove=function(t){if(h){const e=t.clientX-n,o=t.clientY-a;e>=m-250&&o>=p-250&&e<=m+5&&o<=p+5&&(h.style.left=e+"px",h.style.top=o+"px")}}}async function E(e=!1){if(y=window.WebChat.createDirectLine({token:"Cplct14nKy8.d5j4NUrH947YVqa1DrjaXXZUpe_WvxqKbYKr-uSuMAA",domain:"https://directline.botframework.com/v3/directline"}),!v||e){const e=localStorage.getItem("x-unir-student-id"),o=null!=e?e:function(){let t=(new Date).getTime(),e="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){let a=16*Math.random();return t>0?(a=(t+a)%16|0,t=Math.floor(t/16)):(a=(e+a)%16|0,e=Math.floor(e/16)),("x"===n?a:3&a|8).toString(16)}))}(),i="es-ES",s=window.WebChat.createStore({},(({dispatch:e})=>n=>a=>{if("DIRECT_LINE/INCOMING_ACTIVITY"===a.type){botWebChatSettings.userAvatarImage||function(){for(var t=0;t<20;t++)setInterval((()=>{const e=document.querySelectorAll(".webchat__stacked-layout--hide-avatar .webchat__stacked-layout__main .webchat__stacked-layout__avatar-gutter");if(e.length>1){for(let t=1;t<e.length;t++)e[t].remove();t=20}}),t+1)}(),function(){for(var t=0;t<20;t++)setInterval((()=>{const e=document.querySelector(".webchat__suggested-actions");if(e){switch(l){case"canvas":e.style.bottom="114px";break;case"moodle":e.style.bottom="130px"}const n=document.querySelectorAll(".webchat__basic-transcript__activity-body");n.forEach((t=>{t.style.paddingBottom=""})),n.length>3&&(n[n.length-1].style.paddingBottom="60px"),t=20}}),t+1)}(),"bot"==a.payload.activity.from.role&&void 0!==a.payload.activity.text&&"message"==a.payload.activity.type&&(clearTimeout(u),e(function({id:t}){return{type:"WEB_CHAT/DISMISS_NOTIFICATION",payload:{id:t}}}({id:"waiting"})));const n=t("x-unir-");n.messageEvaluatedId=sessionStorage.getItem("messageEvaluatedId");const o=()=>{e({type:"WEB_CHAT/SEND_EVENT",payload:{name:"webchat/greetings",value:n}})};"back/handshake"===a.payload.activity.name&&(a.payload.activity.value.StudentPreferences.DisableStartMaximized&&(g.StudentPreferences.DisableStartMaximized=a.payload.activity.value.StudentPreferences.DisableStartMaximized),g.TermsOfUseInfo.TermsAndConditionsOfUseUrl=a.payload.activity.value.TermsOfUseInfo.TermsAndConditionsOfUseUrl,g.TermsOfUseInfo.StudentId=a.payload.activity.value.TermsOfUseInfo.StudentId,g.StudentPreferences.StudentId=a.payload.activity.value.StudentPreferences.StudentId,g.TermsOfUseInfo.IsTermsOfUseAccepted=a.payload.activity.value.TermsOfUseInfo.IsTermsOfUseAccepted,a.payload.activity.value.TermsOfUseInfo.IsTermsOfUseAccepted?o():e({type:"WEB_CHAT/SEND_EVENT",payload:{name:"webchat/acceptTermsAndConditions",value:n}})),"back/acceptedTermsAndConditions"===a.payload.activity.name&&o(),"back/closeChatbot"===a.payload.activity.name&&T()}if("DIRECT_LINE/POST_ACTIVITY"===a.type){void 0===a.payload.activity.name&&"👍"!=a?.payload?.activity?.text&&function(t){u=setTimeout((()=>{t(function({alt:t,data:e,id:n,level:a,message:o}){return n&&"string"==typeof n||(console.warn('botframework-webchat: The "id" argument passed to "setNotification" must be a string; defaulting to a random value.'),n=uniqueID()),a&&"string"==typeof a||(console.warn('botframework-webchat: The "level" argument passed to "setNotification" must be a string; defaulting to "info".'),a="info"),{type:"WEB_CHAT/SET_NOTIFICATION",payload:{alt:t,data:e,id:n,level:a,message:o}}}({alt:"",data:"",id:"waiting",level:"info",message:"Estamos procesando su respuesta, por favor espere"}))}),1e3*parseInt("7"))}(e);const n=t("x-unir-");n.messageEvaluatedId=sessionStorage.getItem("messageEvaluatedId"),a=window.simpleUpdateIn(a,["payload","activity","channelData"],(()=>n))}if("DIRECT_LINE/POST_ACTIVITY_FULFILLED"===a.type){var o=a?.payload?.activity?.id,i=a?.payload?.activity?.text;o&&"👍"!=i&&"👎"!=i&&sessionStorage.setItem("messageEvaluatedId",o)}if("DIRECT_LINE/CONNECT_FULFILLED"===a.type){const n=t("x-unir-");n.messageEvaluatedId=sessionStorage.getItem("messageEvaluatedId"),e({type:"WEB_CHAT/SEND_EVENT",payload:{name:"webchat/handshake",value:n}})}return n(a)})),r=(n=s,()=>t=>({activity:e,attachment:a,...o})=>{const{activities:i}=n.getState(),s=i.filter((t=>"message"===t.type)).pop()===e;if("application/vnd.microsoft.card.adaptive"===a.contentType){const t=!s;return Components.AdaptiveCardContent({actionPerformedClassName:"card__action--performed",content:a.content,disabled:t})}return t({activity:e,attachment:a,...o})});window.WebChat.renderWebChat({adaptiveCardsHostConfig:botWebChatSettings.adaptiveCardsHostConfig,directLine:y,attachmentMiddleware:r,locale:i,store:s,styleOptions:botWebChatSettings.styleOptions,userID:e,username:o},document.getElementById(a)),v=!0,document.querySelector(`#${a} > *`).focus()}var n;document.getElementById(o).style.display="none",document.getElementById(s).style.display="block",document.getElementById(i).style.pointerEvents="auto"}function x(){document.getElementById("unir-bot-menu").style.display=b?"none":"block",b=!b}function S(t){if(t){let e=t.getBoundingClientRect();const n=C();null==f&&(f=t.style),t.style=f,e.width>n.right&&(t.style.width=n.right-botWebChatSettings.boundaryPadding+"px",e=t.getBoundingClientRect()),e.height>n.bottom&&(t.style.height=n.bottom-botWebChatSettings.boundaryPadding+"px",e=t.getBoundingClientRect()),e.left<n.left&&(t.style.left=`${n.left}px`),e.top<n.top&&(t.style.top=`${n.top}px`),e.right>n.right&&(t.style.left=n.right-e.width+"px"),e.bottom>n.bottom&&(t.style.top=n.bottom-e.height+"px")}}function _(){"canvas"!=l&&"lms30"!=l||(w("https://unpkg.com/simple-update-in/dist/simple-update-in.production.min.js",!0,!1),w("https://cdn.botframework.com/botframework-webchat/latest/webchat.js",!0,!0));const t=function(){const t=document.createElement("div");t.setAttribute("id",r);var e=document.createElement("div"),n=document.createElement("h1");return n.textContent="Asistente virtual",e.appendChild(n),t.appendChild(e),t.appendChild(function(){const t=document.createElement("button");return t.setAttribute("id",d),t.setAttribute("onclick","hideBotWebChat()"),t}()),t}(),e=function(){const t=document.createElement("button");return t.setAttribute("id",o),t.setAttribute("onclick","initBotWebChat()"),t}(),n=document.createElement("div");n.setAttribute("id",s),n.appendChild(t),n.appendChild(function(){const t=document.createElement("div");return t.setAttribute("id",a),t.setAttribute("role","main"),t}()),n.tabIndex=-1;const u=document.createElement("div");u.setAttribute("id",i),u.appendChild(n),u.appendChild(e);const m=document.getElementById(c);null===m?document.body.appendChild(u):m.appendChild(u),botWebChatSettings.dragBotWebChat&&I(t),e.addEventListener("mouseenter",(function(){botWebChatSettings.dragBotWebChatButton&&(e.setAttribute("onclick","detectDragOrClick()"),I(e))})),botWebChatSettings.resizeBotWebChat&&function(t){function e(t){const e=document.createElement("div");return e.classList.add(t),e.addEventListener("mousedown",l),e}t.appendChild(e("resizer--n")),t.appendChild(e("resizer--s")),t.appendChild(e("resizer--w")),t.appendChild(e("resizer--e")),t.appendChild(e("resizer--nw")),t.appendChild(e("resizer--ne")),t.appendChild(e("resizer--sw")),t.appendChild(e("resizer--se"));const n=t.offsetHeight,a=t.offsetWidth;let o,i,s=0,r=0,d=0,c=0;function l(e){e.preventDefault();const l=e.target,u=t.getBoundingClientRect();function m(e){const u=C();function m(e){const a=o+(e.pageY-c);a>n&&a<u.bottom-r&&(t.style.height=a+"px")}function p(e){const a=o-(e.clientY-c);a>n&&a<r+o-u.top&&(t.style.height=a+"px",t.style.top=r+(e.pageY-c)+"px")}function f(e){const n=i+(e.pageX-d);n>a&&n<=u.right-s&&(t.style.width=n+"px")}function g(e){const n=i-(e.pageX-d);n>a&&n<=s+i-u.left&&(t.style.width=n+"px",t.style.left=s+(e.pageX-d)+"px")}l.classList.contains("resizer--s")&&m(e),l.classList.contains("resizer--n")&&p(e),l.classList.contains("resizer--e")&&f(e),l.classList.contains("resizer--w")&&g(e),l.classList.contains("resizer--se")&&(m(e),f(e)),l.classList.contains("resizer--sw")&&(m(e),g(e)),l.classList.contains("resizer--ne")&&(p(e),f(e)),l.classList.contains("resizer--nw")&&(p(e),g(e))}function p(){document.removeEventListener("mousemove",m)}i=t.offsetWidth,o=t.offsetHeight,s=u.left,r=u.top,d=e.pageX,c=e.pageY,document.addEventListener("mousemove",m),document.addEventListener("mouseup",p),document.addEventListener("mouseleave",p)}}(u)}function T(){document.getElementById(o).style.display="block",document.getElementById(s).style.display="none",document.getElementById(i).style.pointerEvents="none",b&&x()}async function L(t,e){const n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentDomain:t,userId:e})};var a=await fetch("https://app-ubot2-pro.azurewebsites.net/api/get-user-fullname",n);return a.ok||console.error("Get fullname response was not ok"),await a.json()}async function k(t,e){const n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentDomain:t,userId:e})};var a=await fetch("https://app-ubot2-pro.azurewebsites.net/api/startup",n);return a.ok||console.error("Bot startup response was not ok"),await a.json()}window.getStudentData=function(t){t&&localStorage.setItem("x-unir-student-id",t.sis_user_id)},window.getStudentData,async function(){await new Promise((t=>setTimeout(t,1e3))),document.cookie="UNIR_CONTROL=nCVF219ZcGRzyPNzykD40X7QeEkiQSAW1VUA7W8JTd8D5kcVdndxF6fj91PLSwYhK7h3NknYWjBRJc;path=/";var t=!1,e=window.location.hostname;switch(l=await async function(t){var e=await fetch(`https://app-ubot2-pro.azurewebsites.net/api/get-platform/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});return 204==e.status?{apiUrl:"",platform:"unknown"}:(e.ok||console.error("Get platform response was not ok"),await e.text())}(e),l){case"lms30":t=!0;break;case"moodle":var n=function(){const t=`; ${document.cookie}`.split("; UNIR_SESSION=");return 2===t.length?t.pop().split(";").shift():null}();if(n){var a=await L(e,n);localStorage.setItem("x-unir-student-id",a.IdGestor),localStorage.setItem("x-unir-student-name",a.FirstName),localStorage.setItem("x-unir-student-lastname",a.LastName);var o=a?.IdPlatform?.toString();o&&(t=await k(e,o))}break;case"canvas":var i=localStorage.getItem("current_user_id");if(i){var s=await L(e,i);localStorage.setItem("x-unir-student-id",s.IdGestor),localStorage.setItem("x-unir-student-name",s.FirstName),localStorage.setItem("x-unir-student-lastname",s.LastName),t=await k(e,i)}}var r=localStorage.getItem("x-unir-student-id"),d=localStorage.getItem("x-unir-student-name"),c=localStorage.getItem("x-unir-student-lastname"),u=!1;r&&d&&c||(console.error("There was an error while loading UBot."),u=!0);var m=!1;t&&(m=!0),m&&!u&&(_(),window.isDraggingBotWebChatElement=!1,document.addEventListener("mousedown",(()=>window.isDraggingBotWebChatElement=!1)),document.addEventListener("mousemove",(()=>window.isDraggingBotWebChatElement=!0)))}(),window.detectDragOrClick=function(){window.isDraggingBotWebChatElement||E()},window.handleSettingsDisplay=x,window.hideBotWebChat=T,window.initBotWebChat=E,window.EventEmitter=new e,document.addEventListener("DOMContentLoaded",(function(){S(document.getElementById(i))})),window.addEventListener("resize",(t=>{S(document.getElementById(i));const e=document.getElementById(o);botWebChatSettings.dragBotWebChatButton&&"block"===e.style.display&&S(document.getElementById(o))}))})()})();